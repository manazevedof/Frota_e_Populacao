---
title: "População e Frota de Veículos"
author: "Mario Azevedo"
date: "Domingo, 24/05/2015"
output:
  html_document:
    keep_md: yes
  word_document: default
---

###Carregando as bibliotecas necessárias

```{r, message=FALSE, warning=FALSE}
library(data.table)
library(dplyr)
library(stringr)
library(knitr)
library(ggplot2)
library(scales)
options(scipen=1, digits=2, width=105)
```

###Lendo os dados

Os dados da frota são de dezembro de 2013 (DENATRAN). Os dados de população são de outubro de 2013 (estimativa do IBGE).


```{r}
dados <- fread('FrotaBR122013.csv',sep=';')
estados <- fread('estados.csv',sep=';')
estados <- mutate(estados,CAPITAL=str_trim(CAPITAL))
estados <- mutate(estados,ESTADO=str_trim(ESTADO))
setkey(dados,UF)
setkey(estados,SIGLA)
dados <- select(dados[estados],-c(ESTADO,CAPITAL))
```

###Características Gerais

1. Número de municípios, população e frota total, de automóveis e motocicletas por estado

```{r}
tabela <- group_by(dados,UF) %>%
        summarise(Nmun = n(),
                  Populacao = sum(POPULACAO),
                  Veiculos = sum(TOTAL),
                  Automoveis = sum(AUTOMOVEL),
                  Motocicletas = sum(MOTOCICLETA))

kable(tabela)
```

2. População e frota total, de automóveis e motocicletas das capitais

```{r}
tabela <- filter(dados, str_c(UF,MUNICIPIO,sep='-') %in% 
                         str_c(estados$SIGLA,estados$CAPITAL,sep='-')) %>%
        mutate(APM = 1000 * AUTOMOVEL/POPULACAO) %>%
        mutate(MPM = 1000 * MOTOCICLETA/POPULACAO) %>%
        select(UF,MUNICIPIO,POPULACAO,TOTAL,AUTOMOVEL,APM,MOTOCICLETA,MPM) %>%
        arrange(desc(APM))

APMcap <- 1000 * sum(tabela$AUTOMOVEL)/sum(tabela$POPULACAO)
APMcap
APMbr <- 1000 * sum(dados$AUTOMOVEL)/sum(dados$POPULACAO)
APMbr

kable(tabela)
ordem <- reorder(tabela$MUNICIPIO,tabela$APM)
ggplot(data=tabela, aes(x=ordem, y=APM)) +
        geom_bar(stat="identity",fill="darkblue") +
        coord_flip() +
        geom_hline(aes(yintercept=APMcap),color="red") +
        geom_hline(aes(yintercept=APMbr),color="green") +
        xlab("Capitais") +
        ylab("Automóveis por 1000 Habitantes")
        
        
```

3. População e frota total, de automóveis e motocicletas das regiões

```{r}
tabela <- group_by(dados,REGIAO) %>%
                summarise(Populacao = sum(POPULACAO),
                  Veiculos = sum(TOTAL),
                  Automoveis = sum(AUTOMOVEL),
                  Motocicletas = sum(MOTOCICLETA)) %>%
        mutate(APM = 1000 * Automoveis/Populacao) %>%
        mutate(MPM = 1000 * Motocicletas/Populacao) %>%
        select(REGIAO,Populacao,Veiculos,Automoveis,APM,Motocicletas,MPM) %>%
        arrange(desc(APM))

APMbr <- 1000 * sum(tabela$Automoveis)/sum(tabela$Populacao)
kable(tabela)
ordem <- reorder(tabela$REGIAO,tabela$APM)
ggplot(data=tabela, aes(x=ordem, y=APM)) +
        geom_bar(stat="identity",fill="darkblue") +
        geom_hline(aes(yintercept=APMbr),color="green") +
        xlab("Regiões") +
        ylab("Automóveis por 1000 Habitantes")
```

